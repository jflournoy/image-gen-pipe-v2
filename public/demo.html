<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Beam Search Rate Limiting Demo</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
      color: #333;
    }

    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      border-radius: 10px;
      margin-bottom: 30px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    h1 {
      font-size: 2em;
      margin-bottom: 10px;
    }

    h2 {
      color: #333;
      margin: 30px 0 15px 0;
      font-size: 1.5em;
    }

    .intro {
      font-size: 1.1em;
      opacity: 0.95;
    }

    .rate-limit-status {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }

    .rate-limit-box {
      background: white;
      border: 2px solid #e0e0e0;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .rate-limit-box:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .rate-limit-box h3 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 1.2em;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .rate-limit-box p {
      margin: 8px 0;
      font-size: 0.95em;
    }

    .rate-limit-box strong {
      color: #333;
      font-weight: 600;
    }

    .metric {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #f0f0f0;
    }

    .metric:last-child {
      border-bottom: none;
    }

    .metric-value {
      font-weight: bold;
      color: #667eea;
    }

    .info-box {
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
      padding: 15px 20px;
      margin: 20px 0;
      border-radius: 4px;
    }

    .info-box h3 {
      color: #1976d2;
      margin-bottom: 10px;
    }

    code {
      background: #f5f5f5;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }

    footer {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid #ddd;
      text-align: center;
      color: #666;
    }
  </style>
</head>
<body>
  <header>
    <h1>üîç Beam Search with Rate Limiting Demo</h1>
    <p class="intro">Real-time visualization of how rate limiting prevents OpenAI API errors (429)</p>
  </header>

  <section>
    <h2>üìä Current Rate Limiting Configuration</h2>
    <div class="rate-limit-status" id="rateLimitStatus">
      <div class="rate-limit-box">
        <h3>üí¨ LLM (GPT-4)</h3>
        <div class="metric">
          <span>Concurrency Limit:</span>
          <span class="metric-value" id="llm-limit">Loading...</span>
        </div>
        <div class="metric">
          <span>Active Requests:</span>
          <span class="metric-value" id="llm-active">0</span>
        </div>
        <div class="metric">
          <span>Queued Requests:</span>
          <span class="metric-value" id="llm-queued">0</span>
        </div>
      </div>

      <div class="rate-limit-box">
        <h3>üé® Image Gen (DALL-E 3)</h3>
        <div class="metric">
          <span>Concurrency Limit:</span>
          <span class="metric-value" id="imageGen-limit">Loading...</span>
        </div>
        <div class="metric">
          <span>Active Requests:</span>
          <span class="metric-value" id="imageGen-active">0</span>
        </div>
        <div class="metric">
          <span>Queued Requests:</span>
          <span class="metric-value" id="imageGen-queued">0</span>
        </div>
      </div>

      <div class="rate-limit-box">
        <h3>üëÅÔ∏è Vision (GPT-4V)</h3>
        <div class="metric">
          <span>Concurrency Limit:</span>
          <span class="metric-value" id="vision-limit">Loading...</span>
        </div>
        <div class="metric">
          <span>Active Requests:</span>
          <span class="metric-value" id="vision-active">0</span>
        </div>
        <div class="metric">
          <span>Queued Requests:</span>
          <span class="metric-value" id="vision-queued">0</span>
        </div>
      </div>
    </div>
  </section>

  <section>
    <div class="info-box">
      <h3>‚ÑπÔ∏è About Rate Limiting</h3>
      <p>
        Rate limiting prevents overwhelming the OpenAI API by controlling how many
        requests can run concurrently. This helps avoid <strong>429 Rate Limit Exceeded</strong> errors.
      </p>
      <p style="margin-top: 10px;">
        <strong>Configuration:</strong> Set via environment variables:
        <code>BEAM_SEARCH_RATE_LIMIT_LLM</code>,
        <code>BEAM_SEARCH_RATE_LIMIT_IMAGE_GEN</code>,
        <code>BEAM_SEARCH_RATE_LIMIT_VISION</code>
      </p>
    </div>
  </section>

  <footer>
    <p>Beam Search Image Generation Pipeline | Rate Limiting Demo</p>
  </footer>

  <script>
    // Load rate limit configuration on page load
    async function loadRateLimitConfig() {
      try {
        const response = await fetch('/api/demo/config');
        const config = await response.json();

        document.getElementById('llm-limit').textContent = config.rateLimits.llm;
        document.getElementById('imageGen-limit').textContent = config.rateLimits.imageGen;
        document.getElementById('vision-limit').textContent = config.rateLimits.vision;
      } catch (error) {
        console.error('Failed to load rate limit config:', error);
      }
    }

    // Load status updates
    async function loadRateLimitStatus() {
      try {
        const response = await fetch('/api/demo/rate-limits/status');
        const status = await response.json();

        document.getElementById('llm-active').textContent = status.llm.active;
        document.getElementById('llm-queued').textContent = status.llm.queued;

        document.getElementById('imageGen-active').textContent = status.imageGen.active;
        document.getElementById('imageGen-queued').textContent = status.imageGen.queued;

        document.getElementById('vision-active').textContent = status.vision.active;
        document.getElementById('vision-queued').textContent = status.vision.queued;
      } catch (error) {
        console.error('Failed to load rate limit status:', error);
      }
    }

    // Initialize
    loadRateLimitConfig();
    loadRateLimitStatus();

    // Update status every 2 seconds
    setInterval(loadRateLimitStatus, 2000);
  </script>
</body>
</html>
